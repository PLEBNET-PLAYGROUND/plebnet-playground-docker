#!/bin/bash
echo "{ \"TIME\": $(date +%s) }"
#padtowidth=8
#for i in 0 {0..200} {200..1000}; do
#    fee=$(printf "%0*d\n" $padtowidth $i;)
#    echo 0.$fee
#done
SELF_ADDRESS=$(bitcoin-cli getnewaddress)
export SELF_ADDRESS
echo { \"SELF_ADDRESS\": \"$SELF_ADDRESS\" }
PLAY_BITCOIN_ADDRESS=$(play-bitcoin getnewaddress)
export PLAY_BITCOIN_ADDRESS
echo { \"PLAY_BITCOIN_ADDRESS\": \"$PLAY_BITCOIN_ADDRESS\" }

host-cli-automate(){
################################################################################
echo "{ \"TIME\": $(date +%s) }"
echo "{ \"settxfee 0.$k\": \"$(bitcoin-cli settxfee 0.0$k)\" }"
echo "{ \"START_TIME\": $(date +%s) }"
TXHASH=$(bitcoin-cli sendtoaddress "$SELF_ADDRESS"  0.0$j)
echo "{ \"TXHASH\": \"$TXHASH\" }"
echo "{ \"TIME\": $(date +%s) }"
TXHASH=$(bitcoin-cli sendtoaddress "$PLAY_BITCOIN_ADDRESS"  0.0$j)
echo "{ \"TXHASH\": \"$TXHASH\" }"
echo "{ \"TIME\": $(date +%s) }"
TXHASH=$(bitcoin-cli -named sendtoaddress address="$SELF_ADDRESS" amount=0.$j )
echo "{ \"TXHASH\": \"$TXHASH\" }"
TXHASH=$(bitcoin-cli -named sendtoaddress address="$PLAY_BITCOIN_ADDRESS" amount=0.$j )
echo "{ \"TXHASH\": \"$TXHASH\" }"
echo "{ \"END_TIME\": $(date +%s) }"
#bitcoin-cli getbalances
#bitcoin-cli listreceivedbyaddress
}
################################################################################
cli-with-play-bitcoin(){
################################################################################
play-getcoins -a $SELF_ADDRESS >> play-getcoins.log
bitcoin-cli -named sendtoaddress address="$PLAY_BITCOIN_ADDRESS" amount=0.$k$j fee_rate=$i$k >> sendtoaddress.log
bitcoin-cli        sendtoaddress         "$PLAY_BITCOIN_ADDRESS" 0.$k$j >> sendtoaddress.log
}
################################################################################
for (( i = 1; i <= 200; i++ ))      ### i loop
do
    export i
    for (( j = 1 ; j <= 9; j++ )) ### j loop
    do
        export j
        #bitcoin-cli        sendtoaddress         "$(bitcoin-cli getnewaddress)" 0.0$j >> sendtoaddress.log
            padtowidth=$j
            for z in 0 {1..30} {30..100}; do
                k=$(printf "%0*d\n" $padtowidth $z;)
                export k
                clear
                echo "{ \"i\": \"$i\" }"
                echo "{ \"j\": \"$j\" }"
                echo "{ \"k\": \"$k\" }"
                bitcoin-cli getbalances
                play-bitcoin getbalances
                host-cli-automate
                cli-with-play-bitcoin
        done
    done
done
echo "End blocknotify script"
blocknotify
#
